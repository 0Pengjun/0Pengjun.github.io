---
layout: post
title: 'web安全 & 前端监控方案'
date: 2018-12-5
author: June
cover: /assets/img/post/2018-11-05/web-security.png
tags: 前端
---

# web安全 & 前端监控方案

<a data-fancybox="gallery" href="{{site.baseurl}}/assets/img/post/2018-11-05/structure.svg">
![文章结构]({{site.baseurl}}/assets/img/post/2018-11-05/structure.svg)
</a>




## 为什么要学习网络安全

首先要明确一下学习目的，作为前端工程师，要守好安全的第一道防线，了解web漏洞，做好web信息安全。

## 了解web安全的基础知识
	信息安全分类
		网络安全
		软件安全
		基础安全
	web安全
		输入输出验证不充分
			跨站脚本攻击(XSS)
				XSS（Cross Site Script）漏洞，从本质上来说就是将数据注入到了静态脚本代码中（HTML或者Javascript等），当浏览器渲染整个HTML文档的过程中触发了注入的脚本，导致了XSS攻击的发生。
				跨站脚本攻击防护
				   跨站脚本漏洞是因为Web应用程序时没有对用户提交的语句和变量进行过滤或限制，攻击者通过Web页面的输入区域向数据库或HTML页面中提交恶意代码，当用户打开有恶意代码的链接或页面时，恶意代码通过浏览器自动执行，从而达到攻击的目的。
			跨站点请求伪造(CSRF)
				登录受信任网站A，并在本地生成Cookie。在不登出A的情况下，访问危险网站B。
				在客户端提交请求时增加伪造随机数。有个程序后端可能是用REQUEST方式接受的，而程序默认是POST请求，其实改成GET方式请求也可以发送过去，存在很严重的隐患。
				CSRF解决方案
					判断HTTP Referer
					图形验证码
					使用隐藏的tonken hash做校验
			sql注入
				用户可以提交一段数据库查询代码，根据程序返回的结果，获得某些他想得知的数据
				SQL注入防护
				由于Web应用程序没有对用户输入数据的合法性进行判断，攻击者通过Web页面的输入区域(如URL、表单等) ，用精心构造的SQL语句插入特殊字符和指令，通过和数据库交互获得私密信息或者篡改数据库信息。
			目录穿越
			文件上传
(网页挂马)
				非法文件上传产生的主要原因就是在服务器端没有对用户上传的文件类型做校验或者校验不完整，导致用户可以上传恶意脚本到服务器。
				文件上传防护
					白名单检查文件扩展名，不属于白名单内的，不允许上传。
					上传文件的保存目录不可解析jsp、php等脚本语言
					文件名随机命名。如UUID、GUID，不允许用户自定义。
					如果允许，对上传的图片文件进行渲染
					记录日志
			代码注入
			命令注入
			信息泄露
				由于Web服务器或应用程序没有正确处理一些特殊请求，泄露Web服务器的一些敏感信息，如用户名、密码、源代码、服务器信息、配置信息等。
				原因
					Web服务器配置存在问题，导致一些系统文件或者配置文件暴露在互联网中；
					Web服务器本身存在漏洞，在浏览器中输入一些特殊的字符，可以访问未授权的文件或者动态脚本文件源码；
					Web网站的程序编写存在问题，对用户提交请求没有进行适当的过滤，直接使用用户提交上来的数据。
			整数溢出
			XXE->XML外部实体注入
				XXE（XML External Entity Injection）是一种针对XML终端实施的攻击，黑客想要实施这种攻击，需要在XML的payload包含外部实体声明，且服务器本身允许实体扩展。这样的话，黑客或许能读取WEB服务器的文件系统，通过UNC路径访问远程文件系统，或者通过HTTP/HTTPS连接到任意主机。
				XXE安全防护
			目录遍历
				服务器端，接收请求中传来的文件名称，在服务器端拼凑成文件的绝对路径，并且用输出流下载
				路径遍历防护
					要下载的文件地址保存至数据库中。
					文件ID使用随机数命名
					文件路径保存至数据库，用户提交文件对应ID下载文件。
					下载文件之前做权限判断。
					记录文件下载日志。
				攻击者向Web服务器发送请求，通过在URL中或在有特殊意义的目录中附加“../”、或者附加“../”的一些变形（如“..\”或“..//”甚至其编码），导致攻击者能够访问未授权的目录，以及在Web服务器的根目录以外执行命令。
			命令执行
				通过URL发起请求，在Web服务器端执行未授权的命令，获取系统信息，篡改系统配置，控制整个系统，使系统瘫痪等。
				情况
					通过目录遍历漏洞，访问系统文件夹，执行指定的系统命令；
					攻击者提交特殊的字符或者命令，Web程序没有进行检测或者绕过Web应用程序过滤，把用户提交的请求作为指令进行解析，导致执行任意命令
		设计缺陷
			越权漏洞
				垂直越权漏洞
					也称为权限提升，是一种“基于URL的访问控制”设计缺陷引起的漏洞。
由于Web应用程序没有做权限控制或者仅在菜单上做了权限控制，导致恶意用户只要猜测其他管理页面的URL，就可以访问或控制其他角色拥有的数据或页面，达到权限提升的目的。
				水平越权漏洞
					是一种“基于数据的访问控制”设计缺陷引起的漏洞。
由于服务器端在接收到请求数据进行操作时没有判断数据的所属人而导致的越权数据访问漏洞。如服务器端从客户端提交的request参数（用户能够控制的数据）中获取用户id，恶意攻击者通过变换请求ID的值，查看或修改不属于本人的数据。
			非授权对象引用
			业务逻辑缺陷
				账户信息安全
				业务数据安全
				业务流程安全
				业务接口安全
		环境缺陷
			框架漏洞
				Struts 2 远程代码执行漏洞
				Java反序列化漏洞
			基础环境漏洞
		其他
			IP登录限制绕过
				系统根据客户端提交的x-forwarded-for值来判断内网登陆还是外网登陆，当客户端请求携带x-forwarded-for值为127.0.0.1时，可直接使用内网登陆方式登陆系统。
			服务端请求伪造攻击
				是由于有些应用（网页分享、站长工具、图片搜索等）提供了通过URL 获取其他站点资源的功能，当这种功能没有对协议、网络边界等做好限制，导致这种功能被滥用，攻击者可以利用这种缺陷获取内网敏感数据、DOS 内网服务器、获取内网服务器权限、读取文件等。
				服务端请求伪造攻击防护
					过滤内网服务器对公网服务器请求的响应。如果Web应用是获取某一类型的文件，在把返回结果展示给用户之前应先验证返回的信息是否符合文件类型标准，比如返回信息应为图片，如果返回信息是HTML，则停止将返回信息返回客户端。
					统一错误提示信息，避免用户可以根据错误信息来判断远端服务器的端口状态。
					在内网服务器的防火墙上限制公网服务器的请求端口为HTTP等协议常用端口，如：80、443、8080、8090。
					若公网服务器的内网IP与内网无业务通信，建议将公网服务器对应的内网IP列入黑名单，避免应用被用来获取内网数据。
					内网服务器禁用不必要的协议，仅允许HTTP和HTTPS请求，防止类似于file:///、gopher://、ftp:// 等协议引起的安全问题。
			异常调试信息泄露
				代码中使用e.printStackTrace()打印异常错误信息，在系统发生异常时，如未自定义错误页面，系统就会将发生异常的详细信息打印出来。

## 做到基础的安全防护

	网站前端安全监控
		跨站脚本攻击(XSS)
		跨站点请求伪造(CSRF)
		点击劫持(ClickJacking)




前端：做好输入验证，错误页

对用户提交的URL、查询关键字、HTTP头、POST数据等进行严格的检测和限制，只接受一定长度范围内、采用适当格式及编码的字符，阻塞、过滤或者忽略其它的任何字符。

https://www.kancloud.cn/chandler/css-code-guide/51260

https://yq.aliyun.com/articles/134479

https://segmentfault.com/a/1190000016551188

https://segmentfault.com/a/1190000016659945


---

觉得文章不错就扫码支持一下呗～

![打赏二维码]({{site.baseurl}}/assets/img/post/pay-qr.jpg)

## 参考链接

* [【干货分享】Web安全漏洞深入分析及其安全编码](http://blog.nsfocus.net/web-vulnerability-analysis-coding-security/)
* [【WEB安全】常见WEB漏洞](https://blog.csdn.net/moshenglv/article/details/53439579)
* [黑客技术/信息安全/网络安全从零学起[更新20180925]](https://zhuanlan.zhihu.com/p/24698829)
* []()
* []()
* []()

