---
title: '区块链扩展性问题概述'
subtitle: '主要谈谈扩容解决方案'
tags: 前端
author: June
cover: /assets/img/post/2019-02-13/cover.png
reward: 1
layout: post
date: 2019-02-13
---

# 区块链扩展性问题概述

<a data-fancybox="gallery" href="{{site.baseurl}}/assets/img/post/2019-02-13/structure.svg">
![文章结构]({{site.baseurl}}/assets/img/post/2019-02-13/structure.svg)
</a>

## 基础概念

### POW

### DPOW

### TPS

TPS，就是“系统每秒钟能够处理的业务数量”，通俗的定义，就是“系统的吞吐量”。

TPS = 并发数/平均响应时间

## 区块链的TPS

对于比特币而言，并发数就是一个区块链里包含的数据大小，目前一个区块的大小是2118。

平均响应时间就是打包一个区块的时间，也就是10分钟，600秒。

那么比特币的TPS=2118÷600=3.53



|||共识|区块大小|出块时间|确认时间|每区块交易数量|TPS|
|:--|:--|:--- |:---|:--|:--|:--|:--|
|公链|比特币|POW|1M|10分钟 |60分钟|1500-2000笔|4|
| |以太坊|POW|2KB以下|15秒|3分钟|70笔交易|20|
| |EOS 2.0|DPOS | |0.5秒 |1秒||百万TPS|
|联盟链|Fabric|Kafka|64M| 可配置 |可配置|可配置|~|


## 为什么区块链的可扩展性这么差呢？

区块链是去中心化的账本技术，需要保证开放性、自治性、不可篡改等特性。去中心化是指使用分布式核算和存储，不存在中心化的硬件或管理机构，任意节点的权利和义务都是均等的，系统中的数据块由整个系统中具有维护功能的节点来共同维护。也就是说，系统中任意节点都需要对交易数据进行全量计算和存储。因此，区块链是没有可扩展性的，即系统的总体性能受限于单个节点的性能上限，即使加入了大量节点，系统的总体性能也无法提升。

可扩展性是传统分布式系统的基本特性，但区块链由于去中心化的要求，可扩展性却难以满足。业界总结了一个三元悖论描述去中心化与可扩展性之间的矛盾，它尚未被严格证明，只能被称为猜想，但实际系统设计过程中却能感觉到时时受其挑战：

去中心化(Decentralization)，安全性(Security)和可扩展性(Scalability)这三个属性，区块链系统无法同时满足，最多只能三选其二。

<a data-fancybox="gallery" href="{{site.baseurl}}/assets/img/post/2019-02-13/reason.jpeg">
![文章结构]({{site.baseurl}}/assets/img/post/2019-02-13/reason.jpeg)
</a>

上图演示了区块链如何在这三个因素之间作选择及对应的策略，例如若若要满足安全性与去中心化，则需要所有节点参与共识、计算、全量存储，但由此带来的问题是失去可扩展性，也就是系统的总体性能无法随着节点的增多而提升；若要满足可扩展性与安全性，则需要中心化管理，需要保证参与共识的节点是可信的；若要满足可扩展性与去中心化，则采用分散存储、计算的策略，不做全量共识，则攻击网络的难度降低，安全性难以保证。

## 扩容解决方案


### 第一层（layer 1）


第一层扩容技术，即改进区块链自身，把区块链自身变的更快、容量变的更大。其实，区块链是一个项目，它本身是由很多个部分组成的。由下往上分别是P2P的网络、共识机制、虚拟机、区块链的编程语言，每一部分都有很大的发展和改进的空间。而区块链的扩容方案是怎么样改进?对于第一层扩容技术来说，其实都是在共识这个部分改进的。

<a data-fancybox="gallery" href="{{site.baseurl}}/assets/img/post/2019-02-13/layer1.png">
![第一层]({{site.baseurl}}/assets/img/post/2019-02-13/layer1.png)
</a>

#### P2P网络

P2P网络是区块链的核心技术之一，因此P2P网络通信的效率对性能的影响非常重要。为了能改善广播通信性能，需要提高节点机器的物理配置，提供高速网络连接，并采用减少广播的共识算法，如DPoS等。

#### 共识

从PoW到PoS再到DPoS和各种BFT类算法，共识机制不断创新，区块链平台性能也得到大幅提升。

#### 分片（Sharding）

分片（Sharding）是一种链上扩容技术，旨在提升协议基础层的容量。

总体思路是每个节点只处理一部分交易，比如一部分账户发起的交易，从而减轻节点的计算和存储负担。

受传统数据库启发而来，分片就是把区块中的数据分成很多不同的“片段”并分别存放在各个节点中，减少每个节点数据存储量的同时，提高系统的验证速度。目前，以太坊上的交易是以线性顺序运行，每个矿工都在执行同样的程序，整个网络的计算能力取决于单台电脑的计算能力。而分片是一种动态的分区验证交易的解决方案，由用户自行选择由哪一个分片执行自己的交易，允许区块处理并行进行。这种“链上”解决方案通过多个网络计算机来分配交易负载，允许更多的交易在同一时间得到确认，从而达到扩容效果。

2017年11月，V神在以太坊开发者大会及台北举行的区块链技术交流会议上表示，分片技术或是可扩展性问题最有可能的解决方案，同时也正是以太坊2.0发展路线图中的重点。今年4月30日，V神发布了一条“分片即将到来”的推文，并分享了一个新的代码库，演示如何把分片扩展解决方案“拴在”以太坊主链上，似乎想表示分片技术正在开始走向落地和实现。

V神从不吝啬对分片技术前景的看好，他相信分片将大幅度改善以太坊现有的并发限制，真正实现扩容。分片被业界视为更为长期有效的、且理论上可行的扩容方案，不过该方案的实施还面临诸多技术挑战。比如，需要确保每个片区有足够多的节点来防止单分片接管攻击，因为一个片区节点太少容易出现妥协和欺诈；再如跨分片交易也是一大难点，目前需要冗长的收据和证明；此外，还有在收到无效排序规则时，各片区节点如何识别和验证欺诈行为，并拒绝这个排序规则，以及数据可用性问题等等。

分片（Sharding）是以太坊正在开发中的技术，其大致设计思路是：将区块链网络中的每个区块变为一个子区块链，子区块链中可以容纳若干（目前为100个）打包了交易数据的Collation（大概可以称为“校验块”，为了在分片的情景中将其与区块的概念区分开），这些Collation最终组成一个在主链上区块；因为这些Collation是整体作为区块存在的，所以其数据必定是全部由某个特定的矿工所打包生成，本质上和现有协议中的区块没有区别，所以不再需要增加额外的网络确认。这样，每个区块的交易容量就大概扩大了100倍；而且这种设计还有利于未来的继续扩展。

#### 虚拟机

### 第二层（layer 2）

第二层扩容技术，目的是把计算移到链下。怎么来理解第二层扩容技术呢?举一个例子，最近有一个比较火的云斗龙区块链游戏，游戏玩家通过让龙去战斗，让龙升级，然后得奖金。龙的整个战斗过程，如果放到链上，玩家在玩游戏的时候就需要很多的燃料费，并且还要花时间等交易的确定，游戏体验非常不好。因此使用第二层扩容技术，把战斗过程放到链下，最后只把结果给存到链上，这样就会大大改善游戏的体验。这就是第二层技术的一个基本思路。

#### 侧链

将原本的一条链分成多条链，每条链都负责部分计算和存储业务，并且有可扩展性，即链的数量可以随着业务量和数据的增加而增加，系统的总体性能随着链的数量的增加而提升，系统的存储空间也能随着链的数量的增加而扩大。

这里举一个简单的应用场景，帮助大家理解侧链。假设你们公司有一百个员工，因为需要协同工作等原因，员工之间可以通过发一点比特币作为回报，但是你不想每一笔交易都发到链上，而是希望员工之间可以自由的进行交易，同时速度也非常的快。基于这种场景，一种非常直接的交易方式就是所谓的侧链。

<a data-fancybox="gallery" href="{{site.baseurl}}/assets/img/post/2019-02-13/sidechain.jpeg">
![侧链]({{site.baseurl}}/assets/img/post/2019-02-13/sidechain.jpeg)
</a>

首先，你们公司得有自己的一个区块链，然后决定矿工以及服务器的数量。假设我是公司里的一名员工，需要先把比特币存进多重签名钱包里面，这个多重签名钱包需要矿工的签名同意，才能使用里面的资金。所以，员工第一步就是把钱存到这个钱包里面，由矿工签名，签完名之后员工自己在这个公司里面就有了一个钱包。通过这种方式，员工就把主链上的币转到侧链上。而侧链上支撑的功能和主链是一样的，可以交易，所以交易速度就可以更快。而侧链是公司自己跑的，也不会收取你的手续费。

　　显然，对于用户来说，侧链的优势很明显。不过，因为侧链只是在公司内部跑，服务器比较少，会不会很容易受到黑客攻击呢?其实，这也是传统侧链的问题，很可能矿工把你的资产给偷走了，这就需要你信任矿工。对于这个问题，新型第二层扩容技术可以解决。

#### 状态通道（State Channels）

相对于Plasma只能用来做资产交易这个痛点，状态通道可以通过写一个智能合约，可以让你在链下执行任意程序。不过，发起一笔交易时，状态通道首先要在链上创造一个多重签订合约;接下来，是在链下接受这笔交易或者状态的更新，每一笔交易多重合约里面所有人都要签名;而合约发布最终的更新，会检查所有人是否都签名了。

　　但是，状态通道还是有些问题，一个最明显的问题就是用户的数量需要固定，假如用户不固定的，毫无安全性可言。第二个问题是每一笔交易都需要所有人签名，比如玩一个游戏，每一笔交易都需要几千人签名，这笔交易就行不通了。第三个问题你还是需要监视主链，比如想让一些老的交易退出来，你自己需要用更新的交易去挑战之前的老交易，所以这样三个问题。

* lightning network（比特币闪电网络）



* Celer Network



* Counterfactual (L4)



* Raiden（雷电网络）：把一部分交易放在链外

	雷电网络（Raiden Network）是一种利用链下支付通道网络实现以太坊扩容的技术。该项目始于2015年，与比特币上的闪电网络原理类似，雷电技术把以太坊区块上的绝大多数交易转移至链外处理，允许用户通过私下交换转账签名信息实现交易，从而大幅度增加交易处理速度。

	2017年9月，雷电项目的测试网络在以太坊上部署完成，同年12月，“微型雷电网络”（uRaiden）上线以太坊主网。uRaiden是雷电网络的MVP版本，旨在提供一种小额支付机制，类似于比特币的闪电网络。雷电网络方案的主要好处是，能大幅降低每笔交易的燃料费用，但它也主要适用于经常性小额支付场景。

* Fate channels (Funfair)



* one-way payment channels (Spankchain)



* Horizon Games




#### Plasma：把数据放在链外

与雷电网络类似，Plasma也是一种链下扩容解决方案。Plasma项目将区块链设计为树状结构，使用大量“子区块链”来分担主链上的数据储存量，每个子链都能处理和维护它自己的转账记录，同时使用特定技术实现“主链”与“子链”的连接，由主链维护其安全性，主链只需在子链中出现争议时才进行计算，从而实现最优化交易处理速度和效率。如果子链上的节点愿意，它们也可以提交转账信息并输出他们的转账记录到主链。

该方案允许每个Plasma链都可以有自己的标准，也即不同子链可以支持有不同需求的交易(如私有链)，且所有交易都处在同样安全的生态系统内。

2017年8月9日，以太坊创始人与闪电网络白皮书联合作者Joseph Poon提出新型扩容方案“Plasma”。2017年11月，V神在推特上称Plasma实现已经开始。2018年1月，今年1月公布了Plasma MVP版本，是一种基于Plasma的开源合约。据悉，Plasma方案可实现每秒十亿次交易处理量，但具体实施效果怎么样还有待验证，且目前看来，它主要是为代币转移（ERC/ETH）而设计，如何扩展至更复杂的代币（如ERC721）或甚至更通用的状态转换还是未知数。不过，把部分数据放在主链之外处理似乎是一大主流扩容趋势。

Plasma 设计模型有两个主要的分支：Plasma MVP 和 Plasma Cash

Plasma Cash

Plasma Cash怎么理解呢?我们也来举一个例子，首先你在链上锁定资产，接下来在链下转移资产。转移资产是发给一个中心化的服务器，你把钱转给某个人，你在告诉他，转移了这个交易签个名，这个服务器内部有一个小小的区块链，每个区块在链上都有个Mekle(是一个数据结构)。比如你在链下有100万个交易，你不能把他存在链上，但是你可以通过证明的方法，证明你的交易是在这100万个区块里面。因为链下的服务器会产生区块，每个区块有一个哈希值，最后你在链上可以通过哈希值验证这个交易是否在哈希值里面。

　　Plasma解决的就是容量的问题，因为你在链上存的就是哈希值，在链下可以进行无限笔交易，虽然每笔交易等的时间和链上交易的时间是一样的，但是我在链下交易的量就比链上大的多。所以别人是没有办法把你的资产拿走的，虽然是中心化的服务器来解决，但是它本质是解决信任问题，不需要任何人去保护你的资产，你的资产由自己的签名和密钥控制。

　　但是Plasma也存在一些问题，第一个是你只能用来做资产交易;第二个问题是需要等待在链上确认交易;第三个想要确保你的资产安全，你需要一直监视主链，你如果没有监视，你的资产还是可能会被偷走。

* omisego


* Loom Network



#### 十倍协议（tenfold protocol）

以上不管是Plsama还是状态通道都有很大的问题，像Plsama不能支持几万人的扩容，我们怎样去支持大型的扩容?在消费者应用中绝大多数交易的经济价值是有限的，比如云斗龙在链下的战斗，我的龙砍了你的龙一刀，像这些交易相对是较低的。在这些大型的消费者应用中，绝大多数交易的经济价值都是有限，我们如何用一个经济模型来扩容?其实，我们只要打造这样一个系统，确保系统本身交易的价值大于攻击本身的价值。

对于上边这个问题，第二层扩容技术的十倍协议是一种解决方案。首先你在链上锁定资产，在链下将交易通过P2P网络广播给验证者，这些验证者可以通过一个去中心化的文件系统，去下载应用的本身。比如，每个验证者都会在本地跑一套云斗龙这款游戏，链下的交易是通过P2P广播的，每一个验证者都可以知道云斗龙的情况。

　　假如你的龙变成二十级了，有人质疑你的龙实质上是十五级。这时，你可以发起一个挑战，挑战的过程中可以放进一部分抵押金，如果有一些质疑者想要挑战，也是可以放进一部分抵押金，双方都把抵押金放进去之后，经济体里有厉害关系的人就可以投票了，每一个验证者都知道这个龙的情况，最终得票少的一方就会损失掉押金。

　　如果有恶意攻击者想要作恶，必须要占有超过50%的经济。假设攻击者买了云斗龙这款游戏超过50%的经济，他是否会攻击成功?结果是是的。但是你会发现，假如你攻击成功，这个经济体会缩水的，为什么?因为我们有一个链下的广播系统，每个人都可以成为验证者，最后通过攻击得到的这样一个系统，你虽然可以在链上保证不正确的状态，但是实际上所有人在链下都可以看到这是假的，就会导致对整个应用失去信心，从而从这个经济体退出，这个经济体本身就会缩水。而攻击者本身拥有50%的经济，所以攻击者本身是最大的受害群体。因此，这个系统，只要我们保证交易习惯的价值小于攻击者所需要失掉的价值就是可运行的了。

　　和所有的系统一样，十倍协议也有问题。假如你买超过50%的经济体，确实可以攻击这个系统;另外需要解决怎么样激励验证者。

　　最后总结一下，今天我主要讲了第二层的几个解决方案。包括传统的第二层扩容技术侧链，有一个信任问题;而新型的扩容技术，讲到Plasma、状态通道和十倍协议，十倍协议是可以移到链下，扩容的量比状态通道大很多。如果你想要攻击十倍协议，可以通过购买超过50%的经济体来攻击十倍协议

#### Cosmos

Cosmos项目的目的是解决区块链交互操作和可扩展性问题，其区块链间通讯协议可以实现区块链的互联，支持不同区块链之间的资产转移。

网络主要由两部分组成，Cosmos Hub和若干个Zone。

<a data-fancybox="gallery" href="{{site.baseurl}}/assets/img/post/2019-02-13/Cosmos.jpeg">
![侧链]({{site.baseurl}}/assets/img/post/2019-02-13/Cosmos.jpeg)
</a>

Cosmos网络里第一条链是Hub，从名字和功能上都可以把它理解为Cosmos的中心链或者管理员链，所有其它区块链的交易都会在Hub记录，一条区块链上的token可以通过Hub转移到另一条区块链。Hub是Cosmos网络的核心，和其余的Zone是不平等的，从严格意义上讲Cosmos网络不是真正的分布式系统，如果Hub发生了单点故障（当然Hub本身是分布式的，发生问题的机率很小），Cosmos网络的很多特性会不可用。关于这点，白皮书中强调Hub必须得到严格保护。

 每个Zone可以看做是单独的区块链空间。每个Zone会和Hub保持状态同步。Hub通过去中心化的验证人组来保证安全性。Zone1向Zone2做跨链消息时，Zone1先生成消息包，并将其证明发布在Hub上，接下来Hub会生成Zone1的跨链消息包已在Hub上的存在证明的证明发布于Zone2，接下来Zone2收妥消息包，并给出证明发布于Hub上，最后，Hub再给出Zone2的收妥证明的证明发布于Zone2。完成整个跨链消息传递。

#### Polkadot

#### Truebit

* Beacon（信标链）

信标链是POS系统的“主链”，与当前的以太坊区块链并行运行。

---

### 参考链接

* [TPS:如何正确认识区块链上的TPS吞吐量](https://www.bitguai.com/xueyuan/rumen/25168.html)
* [10分钟搞懂区块链扩容，4个解决方案拿走不谢](http://www.btb8.com/rookie/1809/14041.html)
* [都说百万TPS：EOS、迅雷链、以太坊，谁才是区块链3.0的领航者？](https://cloud.tencent.com/developer/article/1151194)
* [Making Sense of Ethereum’s Layer 2 Scaling Solutions: State Channels, Plasma, and Truebit](https://medium.com/l4-media/making-sense-of-ethereums-layer-2-scaling-solutions-state-channels-plasma-and-truebit-22cb40dcc2f4)
* [深度拆解以太坊八大扩容路，V神选择了最难的那条！](https://wallstreetcn.com/articles/3414335)
* [区块链的可扩展性问题及解决方案对比](https://www.odaily.com/post/5134016)
* []()
* []()
* []()
* []()
* []()